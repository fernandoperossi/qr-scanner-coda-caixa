<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Scanner QR Code - Coda</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      text-align: center;
      padding: 20px;
    }
    #reader {
      width: 300px;
      margin: auto;
    }
    #status {
      margin-top: 20px;
      font-weight: bold;
    }
  </style>
  <!-- Biblioteca para leitura de QR Code -->
  <script src="https://unpkg.com/html5-qrcode"></script>
</head>
<body>
  <h2>Escanear QR Code</h2>
  <div id="reader"></div>
  <p id="resultado"></p>
  <p id="status"></p>

  <script>
    // üîë Configura√ß√µes do Coda (substituir pelos seus dados)
    const CODA_API_KEY = "6589a950-8a55-46a5-b658-ab196e49c4e1"; // Exemplo: "abc123..."
    const DOC_ID = "AeDUOeLw7V";            // ID do documento
    const TABLE_NAME = "Scanner";           // Nome da tabela criada no Coda
    const COLUMN_ID = "c-c2KFsNnkvh";           // ID da coluna que vai receber o QR

    // Fun√ß√£o para enviar valor para o Coda
    async function enviarParaCoda(valor) {
      try {
        const response = await fetch(`https://coda.io/apis/v1/docs/${DOC_ID}/tables/${TABLE_NAME}/rows`, {
          method: "POST",
          headers: {
            "Authorization": `Bearer ${CODA_API_KEY}`,
            "Content-Type": "application/json"
          },
          body: JSON.stringify({
            rows: [
              {
                cells: [
                  { column: COLUMN_ID, value: valor }
                ]
              }
            ]
          })
        });

        if (response.ok) {
          document.getElementById("status").innerHTML = "‚úÖ Valor enviado com sucesso!";
        } else {
          const erro = await response.json();
          document.getElementById("status").innerHTML = "‚ùå Erro ao enviar: " + JSON.stringify(erro);
        }
      } catch (err) {
        document.getElementById("status").innerHTML = "‚ùå Erro inesperado: " + err.message;
      }
    }

    // Fun√ß√£o chamada quando QR Code √© escaneado
    function onScanSuccess(decodedText) {
      document.getElementById("resultado").innerText = "QR Code: " + decodedText;
      enviarParaCoda(decodedText);
    }

    // Iniciar leitor
    const html5QrCode = new Html5Qrcode("reader");
    Html5Qrcode.getCameras().then(devices => {
      if (devices && devices.length) {
        html5QrCode.start(
          { facingMode: "environment" }, // c√¢mera traseira
          { fps: 10, qrbox: 250 },
          onScanSuccess
        );
      }
    }).catch(err => {
      document.getElementById("status").innerHTML = "‚ùå Erro ao acessar c√¢mera: " + err;
    });
  </script>
</body>
</html>

